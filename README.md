# β• Coffee Note AI Backend

μ»¤ν”Ό μ• νΈκ°€λ“¤μ„ μ„ν• μ¤λ§νΈν• μ»¤ν”Ό κΈ°λ΅ λ° μ •λ³΄ μ¶”μ¶ AI λ°±μ—”λ“ μ„λΉ„μ¤μ…λ‹λ‹¤. μμ—°μ–΄ μ…λ ¥μ„ λ¶„μ„ν•μ—¬ μ»¤ν”Όμ μ„Έλ¶€ μ •λ³΄λ¥Ό κµ¬μ΅°ν™”ν•κ³ , μ΄λ³΄μλ¥Ό μ„ν• λ§μ¶¤ν• μ„Όμ„λ¦¬ κ°€μ΄λ“λ¥Ό μ κ³µν•©λ‹λ‹¤.

## π€ μ£Όμ” κΈ°λ¥

### 1. μ»¤ν”Ό μ •λ³΄ λ§¤ν•‘ (Coffee Mapping)
- μ‚¬μ©μμ μμ—°μ–΄ μ…λ ¥(μ: "μ—ν‹°μ¤ν”Όμ•„ μκ°€μ²΄ν”„ λ‚΄μ¶”λ΄ λ―Έλ””μ—„ λ΅μ¤νΈ")μ—μ„ μ›μ‚°μ§€, ν’μΆ…, κ°€κ³µ λ°©μ‹, λ΅μ¤ν… ν¬μΈνΈ, μ¶”μ¶ λ°©λ²•, ν…μ΄μ¤ν… λ…ΈνΈλ¥Ό μλ™μΌλ΅ μ¶”μ¶ν•©λ‹λ‹¤.

### 2. μ„Όμ„λ¦¬ κ°€μ΄λ“ (Sensory Guide)
- μ¶”μ¶λ μ»¤ν”Ό μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ μ›Ή κ²€μƒ‰(Tavily)κ³Ό AIλ¥Ό κ²°ν•©ν•μ—¬ ν•΄λ‹Ή μ»¤ν”Όλ¥Ό λ” λ§›μκ² μ¦κΈΈ μ μλ” μ…λ¬Έμμ© κ°€μ΄λ“ λ©”μ‹μ§€λ¥Ό μƒμ„±ν•©λ‹λ‹¤.

### 3. μΌλ° AI μ±„ν…
- μ»¤ν”Όμ™€ κ΄€λ ¨λ λ‹¤μ–‘ν• μ§λ¬Έμ— λ‹µλ³€ν•  μ μλ” μΌλ°μ μΈ AI λ€ν™” κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤.

## π›  κΈ°μ  μ¤νƒ

- **Framework**: FastAPI
- **AI/LLM**: LangChain, OpenAI GPT-4
- **Search API**: Tavily Search
- **Language**: Python 3.11
- **Deployment**: Railway
- **Environment**: Pydantic, Uvicorn, Python-dotenv

## π§  LangChain μ›ν¬ν”λ΅μ°

λ³Έ μ„λΉ„μ¤λ” **Function Calling Agent**μ™€ **LCEL Chain**μ„ κ²°ν•©ν• 2λ‹¨κ³„ ν•μ΄λΈλ¦¬λ“ λ΅μ§μ„ μ‚¬μ©ν•©λ‹λ‹¤.

### 1. Function Calling Agent (μ •λ³΄ μμ§‘ λ‹¨κ³„)
- **μ—­ν• **: μ‚¬μ©μκ°€ μ…λ ¥ν• μ»¤ν”Ό μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ λ¶€μ΅±ν• μ§€μ‹μ΄λ‚ μµμ‹  μ •λ³΄λ¥Ό μ›Ήμ—μ„ κ²€μƒ‰ν•μ—¬ λ³΄μ™„ν•©λ‹λ‹¤.
- **μ—μ΄μ „νΈ**: `create_openai_tools_agent` (Function Calling λ°©μ‹)
- **λ„κµ¬ (Tools)**: `TavilySearchResults` (μ‹¤μ‹κ°„ μ›Ή κ²€μƒ‰)
- **μ‘λ™**: OpenAIμ Function Calling κΈ°λ¥μ„ ν™μ©ν•μ—¬ κµ¬μ΅°ν™”λ λ°©μ‹μΌλ΅ λ„κµ¬λ¥Ό νΈμ¶ν•κ³ , μμ§‘λ μ •λ³΄λ¥Ό μ •λ¦¬ν•μ—¬ λ‹¤μ λ‹¨κ³„λ΅ μ „λ‹¬ν•©λ‹λ‹¤.
- **μ¥μ **: ν…μ¤νΈ νμ‹± κΈ°λ°μ ReAct λ°©μ‹ λ€λΉ„ νμ‹± μ—λ¬κ°€ κ±°μ λ°μƒν•μ§€ μ•μ•„ μ•μ •μ„±μ΄ ν¬κ² ν–¥μƒλμ—μµλ‹λ‹¤.

### 2. LCEL Chain (κµ¬μ΅°ν™” λ° κ°€μ΄λ“ μƒμ„± λ‹¨κ³„)
- **μ—­ν• **: μμ§‘λ "ν’λ¶€ν• μ •λ³΄(Enriched Info)"λ¥Ό λ°”νƒ•μΌλ΅ μµμΆ… μ‘λ‹µ ν•μ‹μ„ μƒμ„±ν•©λ‹λ‹¤.
- **κµ¬μ„±**: `PromptTemplate | LLM | OutputParser`
- **μ¶λ ¥ νμ„ (Parser)**: `PydanticOutputParser`λ¥Ό μ‚¬μ©ν•μ—¬ JSON μ‘λ‹µμ μ•μ •μ„±μ„ λ³΄μ¥ν•©λ‹λ‹¤.
- **μ‘λ™**: μ—μ΄μ „νΈκ°€ μμ§‘ν• μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ μ‚¬μ „μ— μ •μλ Enum κ°’μ— λ§μ¶° λ°μ΄ν„°λ¥Ό λ§¤ν•‘ν•κ±°λ‚, μμ—°μ¤λ¬μ΄ μ„Όμ„λ¦¬ κ°€μ΄λ“ λ¬Έμ¥μ„ μƒμ„±ν•©λ‹λ‹¤.

## π“ ν”„λ΅μ νΈ κµ¬μ΅°

```text
/
β”β”€β”€ main.py            # μ–΄ν”λ¦¬μΌ€μ΄μ… μ§„μ…μ  λ° λΌμ°ν„° λ“±λ΅
β”β”€β”€ api.py             # API μ—”λ“ν¬μΈνΈ μ •μ λ° μ”μ²­/μ‘λ‹µ μ²λ¦¬
β”β”€β”€ service.py         # λΉ„μ¦λ‹μ¤ λ΅μ§ λ° AI μ›ν¬ν”λ΅μ° μ μ–΄
β”β”€β”€ schema.py          # Pydantic λ°μ΄ν„° λ¨λΈ λ° μ¤ν‚¤λ§
β”β”€β”€ infra/             # μΈν”„λΌ λ μ΄μ–΄
β”‚   β””β”€β”€ langchain/     # LangChain μ„¤μ • (LLM, Prompt, Tools, Agent)
β”β”€β”€ docs/              # ν”„λ΅μ νΈ λ¬Έμ„ (API λ…μ„Έμ„ λ“±)
β””β”€β”€ requirements.txt   # μμ΅΄μ„± ν¨ν‚¤μ§€ λ©λ΅
```

## β™οΈ μ‹μ‘ν•κΈ°

### 1. ν™κ²½ λ³€μ μ„¤μ •
`.env` νμΌμ„ μƒμ„±ν•κ³  ν•„μ”ν• API ν‚¤λ¥Ό μ„¤μ •ν•©λ‹λ‹¤.

```env
OPENAI_API_KEY=your_openai_api_key
TAVILY_API_KEY=your_tavily_api_key
```

### 2. μμ΅΄μ„± μ„¤μΉ
```bash
pip install -r requirements.txt
```

### 3. μ„λ²„ μ‹¤ν–‰
```bash
uvicorn main:app --reload
```

## π“– API λ…μ„Έ

μμ„Έν• API λ…μ„Έλ” [`docs/api_spec.md`](docs/api_spec.md) νμΌμ—μ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

- **POST /chat**: μΌλ° AI μ±„ν…
- **POST /chat-for-mapping**: μ»¤ν”Ό μ •λ³΄ κµ¬μ΅°ν™” μ¶”μ¶
- **POST /chat-for-sensory-guide**: κµ¬μ΅°ν™”λ μ •λ³΄ + μ„Όμ„λ¦¬ κ°€μ΄λ“ μƒμ„±
- **GET /health**: μ„λΉ„μ¤ μƒνƒ μ²΄ν¬
